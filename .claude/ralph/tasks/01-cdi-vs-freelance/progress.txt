# Ralph Progress Log
Started: 2026-02-18
Feature: 01-cdi-vs-freelance

## Codebase Patterns

### Stack
- Next.js 14+ App Router, TypeScript strict, Tailwind CSS
- Client-side only (no backend, no DB)
- Déploiement Vercel

### Structure des fichiers à créer
- src/types/index.ts → Interfaces TypeScript (CdiInputs, FreelanceInputs, CdiResults, FreelanceResults, ComparisonResults)
- src/lib/calculations.ts → Fonctions pures de calcul
- src/components/CdiForm.tsx → Formulaire inputs CDI
- src/components/FreelanceForm.tsx → Formulaire inputs Freelance AE
- src/components/CdiResultCard.tsx → Carte résultats CDI
- src/components/FreelanceResultCard.tsx → Carte résultats Freelance AE
- src/components/ComparisonPanel.tsx → Panneau de comparaison central
- src/app/page.tsx → Page principale (remplace le placeholder)
- src/app/layout.tsx → Layout avec métadonnées

### Formules clés
- CDI net annuel = brut × (1 - tauxCharges)   // tauxCharges: cadre=0.25, non-cadre=0.22
- CDI coût employeur = brut × 1.42
- CDI TJM équivalent = coutEmployeur / joursAnnuel
- AE CA annuel = TJM × jours
- AE cotisations = CA × 0.22
- AE net annuel = CA × 0.78
- TJM break-even = netCDI / (jours × 0.78)
- Brut CDI break-even = netAE / (1 - tauxCharges)
- Jours par défaut = 218

### Patterns de code
- Utiliser 'use client' pour les composants avec useState/useSearchParams
- Formatage monétaire : Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 })
- Composants contrôlés avec props: { onChange: (inputs: T) => void, values?: T }
- Tooltips avec group/hover Tailwind (pas de librairie externe)
- URL sharing : useSearchParams() + useRouter().replace() de 'next/navigation'

---

## 2026-02-18 - US-001: Initialiser le projet Next.js avec TypeScript et Tailwind CSS
- Projet Next.js 16.x créé avec App Router, TypeScript, Tailwind CSS, ESLint
- Dossiers src/components/, src/lib/, src/types/ créés
- page.tsx simplifié à un h1 "CDI vs Freelance", layout.tsx avec métadonnées fr
- npm run build passe sans erreurs
- **Learnings:**
  - `create-next-app .` échoue si .claude/ existe → créer dans /tmp puis rsync --exclude='.git' --exclude='node_modules'
  - next-env.d.ts est dans .gitignore par défaut, ne pas git add
  - Next.js 16.x disponible avec Turbopack, compatible avec les critères "14+"
---

## 2026-02-18 - US-002: Créer les types TypeScript et la bibliothèque de calculs
- Créé src/types/index.ts avec interfaces CdiInputs, FreelanceInputs, CdiResults, FreelanceResults, ComparisonResults
- Créé src/lib/calculations.ts avec calculateCdi(), calculateFreelance(), calculateComparison()
- calculateCdi() prend joursAnnuel en param optionnel (défaut 218) pour calculer tjmEquivalent
- calculateComparison() prend aussi cdiInputs + freelanceInputs pour accéder aux taux de charges et jours
- CdiResults expose tauxChargesApplique pour affichage dans les cartes résultats
- **Learnings:**
  - La signature de calculateComparison() du PRD (2 args) ne suffit pas → il faut passer cdiInputs et freelanceInputs pour les formules break-even
  - Utiliser `(inputs.tauxChargesPersonnalise ?? 22) / 100` pour éviter undefined avec le statut 'personnalise'
  - npx tsc --noEmit est la commande de typecheck (pas pnpm tsc)
---

## 2026-02-18 - US-003: Créer le formulaire CDI
- Créé src/components/CdiForm.tsx (composant contrôlé)
- Input numérique pour salaire brut annuel, select pour statut (cadre/non-cadre/personnalisé), input taux conditionnel
- Props: { onChange: (inputs: CdiInputs) => void, values?: CdiInputs }
- **Learnings:**
  - brutDisplay vide si brutAnnuel === 0 pour éviter "0" dans le champ au départ
  - `tauxChargesPersonnalise: undefined` lors du changement de statut pour reset propre
---

## 2026-02-18 - US-004: Créer le formulaire Freelance Auto-Entrepreneur
- Créé src/components/FreelanceForm.tsx (composant contrôlé)
- Input TJM (€/jour) avec placeholder '450', input jours travaillés/an avec valeur par défaut 218
- Texte d'aide sous le champ jours expliquant les 218 jours standard
- Props: { onChange: (inputs: FreelanceInputs) => void, values?: FreelanceInputs }
- **Learnings:**
  - Même pattern que CdiForm: tjm === 0 → champ vide (pas '0')
  - joursAnnuel défaut 218 via `values?.joursAnnuel ?? 218`
---

## 2026-02-18 - US-005: Créer la carte de résultats CDI
- Créé src/components/CdiResultCard.tsx
- Affiche état vide ("Saisissez un salaire brut") si brutAnnuel === 0 ou results null
- Formatage Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 })
- tauxLabel construit depuis inputs.statut (cadre/non-cadre/personnalisé) + tauxChargesApplique
- Props: { results: CdiResults | null, inputs: CdiInputs }
- **Learnings:**
  - tauxChargesApplique est en décimal (0.25), multiplier par 100 pour affichage %
  - Vérifier à la fois `results === null` ET `brutAnnuel === 0` pour l'état vide
---
